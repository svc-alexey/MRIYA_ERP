
////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

// Обработчик события "ПриСозданииНаСервере" формы
//
// Параметры:
//   Отказ - Булево - Признак отказа от создания формы
//   СтандартнаяОбработка - Булево - Признак выполнения стандартной обработки события
//
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// Получаем ключ разработчика из общего модуля
	ddauth_api_client = MRS_ИнтеграцияДиадокСервер.ПолучитьКлючРазработчикаДиадок();
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ КОМАНД ФОРМЫ

// Обработчик команды "Ок"
// Проверяет введенные данные аутентификации и закрывает форму с результатом
//
// Параметры:
//   Команда - КомандаФормы - Команда, вызвавшая обработчик
//
&НаКлиенте
Процедура Ок(Команда)
	
	// Проверяем заполнение обязательных полей
	Если НЕ ЗначениеЗаполнено(ЛогинНаСайтДиадок) Тогда
		Сообщить("Не заполнен логин");
		Возврат;
	КонецЕсли;
	
	Если НЕ ЗначениеЗаполнено(ПарольНаСайтДиадок) Тогда
		Сообщить("Не заполнен пароль");
		Возврат;
	КонецЕсли;
	
	// Проверяем данные авторизации через общий модуль
	РезультатПроверки = MRS_ИнтеграцияДиадокКлиент.ПроверитьДанныеАвторизации(ЛогинНаСайтДиадок, ПарольНаСайтДиадок);
	
	Если НЕ РезультатПроверки.Успех Тогда
		Сообщить(РезультатПроверки.ТекстОшибки);
		Возврат;
	КонецЕсли;
	
	// Формируем структуру с результатом
	СтруктураВозврата = Новый Структура;
	СтруктураВозврата.Вставить("Логин", ЛогинНаСайтДиадок);
	СтруктураВозврата.Вставить("Пароль", ПарольНаСайтДиадок);
	СтруктураВозврата.Вставить("КлючРазработчикаДиадок", ddauth_api_client);
	
	Закрыть(СтруктураВозврата);
	
КонецПроцедуры